<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POSTURA</title>
  <link rel="icon" type="image/png" href="logo.png">
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(180deg, #fffbea, #fff3c4);
      color: #333;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    header {
      display: flex;
      align-items: center;
      background: #fff7d1;
      padding: 10px 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    header img {
      height: 40px;
      margin-right: 10px;
    }

    h1 {
      color: #d4a017;
      font-weight: 700;
      font-size: 1.5rem;
    }

    .container {
      padding: 20px;
    }

    .instructions {
      text-align: center;
      background: #fffdf3;
      border-radius: 10px;
      padding: 20px;
      max-width: 600px;
      margin: 20px auto;
      border: 1px dashed #f5d45e;
    }

    .instructions h2 {
      color: #e6a700;
      margin-bottom: 10px;
    }

    #output-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 10px;
      position: relative;
    }

    #uploadedImage {
      max-width: 450px;
      border-radius: 10px;
      display: none;
    }

    #overlay {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      color: #e6a700;
      font-weight: 600;
      background: rgba(255, 255, 200, 0.8);
      padding: 10px 20px;
      border-radius: 8px;
    }

    .buttons {
      margin-top: 15px;
    }

    button {
      background: #ffd84d;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      margin: 5px;
      font-size: 14px;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: #ffcc00;
    }

    #angleResult {
      font-weight: 600;
      margin-top: 10px;
    }

    #remarks {
      font-size: 16px;
      margin-top: 5px;
      font-weight: bold;
    }

    #remarks.good {
      color: green;
    }

    #remarks.moderate {
      color: orange;
    }

    #remarks.poor {
      color: red;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo">
    <h1>POSTURA</h1>
  </header>

  <div class="container">
    <div class="instructions">
      <h2>Instructions</h2>
      <ol>
        <li>Upload a side-view photo or use your camera.</li>
        <li>Click on the <strong>tragus (ear)</strong> first.</li>
        <li>Then click on <strong>C7 (neck base)</strong>.</li>
        <li>Save each attempt to record results.</li>
      </ol>
      <img src="CVA.jpg" alt="Instruction Example" style="max-width:300px;border-radius:10px;margin-top:10px;">
    </div>

    <div id="output-container">
      <div id="overlay">Processing... Please wait</div>
      <canvas id="canvas"></canvas>
      <img id="uploadedImage" src="" alt="Uploaded image">
    </div>

    <div id="angleResult"></div>
    <div id="remarks"></div>

    <div class="buttons">
      <button onclick="uploadImage()">Upload Image</button>
      <button onclick="useCamera()">Use Camera</button>
      <button onclick="resetImage()">Reset</button>
      <button onclick="saveAttempt()">Save Attempt</button>
      <button onclick="viewHistory()">History</button>
    </div>
  </div>

  <script>
    const uploadedImage = document.getElementById('uploadedImage');
    const overlay = document.getElementById('overlay');
    const angleResult = document.getElementById('angleResult');
    const remarks = document.getElementById('remarks');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let tragus = null, c7 = null, imageLoaded = false;

    function uploadImage() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (event) {
            overlay.style.display = 'block';
            uploadedImage.style.display = 'none';
            setTimeout(() => {
              uploadedImage.src = event.target.result;
              uploadedImage.style.display = 'block';
              overlay.style.display = 'none';
              imageLoaded = true;
              drawOverlay();
            }, 1800);
          };
          reader.readAsDataURL(file);
        }
      };
      input.click();
    }

    function drawOverlay() {
      canvas.width = uploadedImage.width;
      canvas.height = uploadedImage.height;
      canvas.style.position = 'absolute';
      canvas.style.left = '50%';
      canvas.style.transform = 'translateX(-50%)';
      canvas.style.top = uploadedImage.offsetTop + 'px';
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = 'rgba(255, 230, 0, 0.3)';
      ctx.lineWidth = 40;
      ctx.strokeRect(0, 0, canvas.width, canvas.height);
    }

    canvas.addEventListener('click', function (event) {
      if (!imageLoaded) return alert("Please upload an image first.");
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      // simulate “body detection area”
      if (y < canvas.height * 0.2 || y > canvas.height * 0.9) {
        alert("Warning: Click on the person.");
        return;
      }

      if (!tragus) {
        tragus = { x, y };
        drawPoint(x, y, 'red');
      } else if (!c7) {
        c7 = { x, y };
        drawPoint(x, y, 'red');
        drawLine(tragus, c7);
        calculateAngle();
      }
    });

    function drawPoint(x, y, color) {
      ctx.beginPath();
      ctx.arc(x, y, 5, 0, 2 * Math.PI);
      ctx.fillStyle = color;
      ctx.fill();
    }

    function drawLine(p1, p2) {
      ctx.beginPath();
      ctx.moveTo(p1.x, p1.y);
      ctx.lineTo(p2.x, p2.y);
      ctx.strokeStyle = 'yellow';
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    function calculateAngle() {
      const dx = c7.x - tragus.x;
      const dy = tragus.y - c7.y;
      const angle = Math.abs((Math.atan2(dy, dx) * 180) / Math.PI);
      angleResult.textContent = `Craniovertebral Angle: ${angle.toFixed(2)}°`;

      if (angle >= 50) {
        remarks.textContent = "Good Forward Head Posture";
        remarks.className = "good";
      } else if (angle >= 45) {
        remarks.textContent = "Moderate Forward Head Posture";
        remarks.className = "moderate";
      } else {
        remarks.textContent = "Poor Forward Head Posture";
        remarks.className = "poor";
      }
    }

    function resetImage() {
      tragus = null;
      c7 = null;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      angleResult.textContent = "";
      remarks.textContent = "";
      if (imageLoaded) drawOverlay();
    }

    function saveAttempt() {
      if (!angleResult.textContent) return alert("No results to save.");
      alert("Attempt saved!");
    }

    function viewHistory() {
      alert("History feature coming soon.");
    }

    function useCamera() {
      alert("Camera feature not yet implemented.");
    }
  </script>
</body>
</html>
